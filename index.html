<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Campo Express</title>
    <link rel="stylesheet" href="css/styles.css">
  <!-- Favicon and manifest -->
  <link rel="apple-touch-icon" href="css/campoExpress.png">
  <link rel="icon" type="image/png" href="css/campoExpress.png">
  <link rel="manifest" href="site.webmanifest">
  <meta name="theme-color" content="#2F9E44">
  </head>
  <body>
    <!-- Navbar -->
    <header class="navbar">
        <div class="container nav-inner">
        <a class="brand" href="#">Campo Express</a>
        <nav class="nav-links">
          <a href="#nosotros">Nosotros</a>
          <a href="#modelo-de-negocio">Modelo de Negocio</a>
          <button class="btn btn-primary" id="btn-access">Acceder</button>
        </nav>
        <button class="nav-toggle" aria-label="Abrir menú">☰</button>
      </div>
    </header>

    <!-- Hero -->
    <section class="hero">
      <div class="container hero-inner">
        <div class="hero-text">
          <h1>Frutas y verduras frescas, directo a tu puerta</h1>
          <p>Seleccionamos lo mejor del día para que disfrutes productos frescos, locales y saludables.</p>
          <a class="btn btn-cta" href="#productos">Ver productos</a>
        </div>
        <div class="hero-visual">
          <img src="css/campoExpress.png" alt="Frutas y verduras frescas de Campo Express">
        </div>
      </div>
    </section>

    <!-- Productos -->
    <main class="container">
      <section id="productos" class="products">
        <h2>Nuestras Tiendas</h2>
        <p class="lead">Elige las tiendas mas cercanas</p>
        <div class="grid">
          <article class="card">
            <img src="https://via.placeholder.com/300x200?text=Manzanas" alt="Manzanas frescas">
            <div class="card-body">
              <h3>Manzana roja</h3>
              <p>Deliciosas manzanas crujientes, ideales para snacks y postres.</p>
              <div class="card-foot">
                <span class="price">$2.50 / kg</span>
                <button class="btn btn-outline">Agregar</button>
              </div>
            </div>
          </article>

          <article class="card">
            <img src="https://via.placeholder.com/300x200?text=Plátanos" alt="Plátanos maduros">
            <div class="card-body">
              <h3>Plátano</h3>
              <p>Maduros y dulces, perfectos para batidos y snacks.</p>
              <div class="card-foot">
                <span class="price">$1.80 / kg</span>
                <button class="btn btn-outline">Agregar</button>
              </div>
            </div>
          </article>

          <article class="card">
            <img src="https://via.placeholder.com/300x200?text=Zanahorias" alt="Zanahorias frescas">
            <div class="card-body">
              <h3>Zanahoria</h3>
              <p>Crujientes y llenas de sabor, excelentes para cocinar y ensaladas.</p>
              <div class="card-foot">
                <span class="price">$1.20 / kg</span>
                <button class="btn btn-outline">Agregar</button>
              </div>
            </div>
          </article>

          <article class="card">
            <img src="https://via.placeholder.com/300x200?text=Paquete+Eco" alt="Paquete eco">
            <div class="card-body">
              <h3>Pack Eco</h3>
              <p>Selección de temporada: frutas y verduras para una familia pequeña.</p>
              <div class="card-foot">
                <span class="price">$12.00 / pack</span>
                <button class="btn btn-outline">Agregar</button>
              </div>
            </div>
          </article>
        </div>
      </section>

      <!-- Sección Nosotros -->
      <section id="nosotros" class="about">
        <h2>Nosotros</h2>
        <p>Campo Express es una plataforma que conecta fruvers con consumidores que buscan productos frescos y de calidad.</p>
      </section>

      <!-- Modelo de Negocio -->
      <section id="modelo-de-negocio" class="model">
        <h2>Modelo de Negocio</h2>
        <div class="model-inner">
          <img src="css/modeloCanvas.jpg" alt="Diagrama del modelo de negocio" class="zoomable">
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer id="contacto" class="site-footer">
      <div class="container footer-inner">
        <div class="footer-col">
          <h3>Campo Express</h3>
          <p>Frutas y verduras frescas, seleccionadas con cariño.</p>
        </div>
        <div class="footer-col">
          <h4>Contacto</h4>
          <p>Email: contacto@campoexpress.com</p>
          
        </div>
      </div>
      <div class="footer-bottom">
        <div class="container">© 2025 Campo Express — </div>
      </div>
    </footer>

    <div class="image-modal" aria-hidden="true" role="dialog" aria-label="Imagen ampliada">
      <button class="image-modal__close" aria-label="Cerrar imagen">&times;</button>
      <img src="" alt="">
      <div class="close-hint">Presiona Esc o clic fuera para cerrar</div>
    </div>

    <!-- Modal de autenticación (login / registro) -->
    <div class="auth-modal" aria-hidden="true" role="dialog" aria-label="Autenticación">
      <div class="auth-panel" role="document">
        <button class="auth-close" aria-label="Cerrar">&times;</button>
        <div class="auth-tabs">
          <button class="auth-tab active" data-target="login">Iniciar sesión</button>
          <button class="auth-tab" data-target="register">Registrarse</button>
        </div>
        <div class="auth-body">
          <form id="login-form" class="auth-form active">
            <label for="login-email">Correo</label>
            <input id="login-email" name="email" type="email" required>
            <label for="login-pass">Contraseña</label>
            <input id="login-pass" name="password" type="password" required>
            <button class="btn btn-primary" type="submit">Entrar</button>
          </form>

          <form id="register-form" class="auth-form">
            <label for="reg-email">Correo</label>
            <input id="reg-email" name="email" type="email" required>
            <label for="reg-pass">Contraseña</label>
            <input id="reg-pass" name="password" type="password" required>
            <label for="reg-role">Rol</label>
            <select id="reg-role" name="role" required>
              <option value="">-- Selecciona rol --</option>
              <option value="fruver">Fruver</option>
              <option value="cliente">Cliente</option>
            </select>
            <label for="reg-barrio">Barrio</label>
            <select id="reg-barrio" name="barrio" required>
              <option value="">-- Selecciona barrio --</option>
              <option value="cabecera">Cabecera</option>
              <option value="provenza">Provenza</option>
              <option value="san-alonso">San Alonso</option>
            </select>
            <label for="reg-direccion">Dirección</label>
            <input id="reg-direccion" name="direccion" type="text" placeholder="Calle, número y referencias" required>
            <button class="btn btn-primary" type="submit">Crear cuenta</button>
          </form>
        </div>
      </div>
    </div>

    <script>
      // Simple toggle para menú móvil
      const toggle = document.querySelector('.nav-toggle');
      const navLinks = document.querySelector('.nav-links');
      toggle?.addEventListener('click', ()=>{
        navLinks?.classList.toggle('open');
      });

      // Imagen zoomable -> modal fullscreen
      (function(){
        const zoomables = document.querySelectorAll('.zoomable');
        const modal = document.querySelector('.image-modal');
        if(!modal) return;
        const modalImg = modal.querySelector('img');
        const closeBtn = modal.querySelector('.image-modal__close');

        function openModal(src, alt){
          modalImg.src = src;
          modalImg.alt = alt || '';
          modal.classList.add('open');
          modal.setAttribute('aria-hidden','false');
          document.documentElement.classList.add('no-scroll');
          document.body.classList.add('no-scroll');
          closeBtn.focus();
        }

        function closeModal(){
          modal.classList.remove('open');
          modal.setAttribute('aria-hidden','true');
          modalImg.src = '';
          document.documentElement.classList.remove('no-scroll');
          document.body.classList.remove('no-scroll');
        }

        zoomables.forEach(img=>{
          img.addEventListener('click', ()=>{
            openModal(img.getAttribute('src') || img.dataset.src, img.getAttribute('alt'));
          });
        });

        // Close on click outside image or on close button
        modal.addEventListener('click', (e)=>{
          if(e.target === modal || e.target === closeBtn) closeModal();
        });

        // Avoid closing when clicking the image itself
        modal.querySelector('img')?.addEventListener('click', (e)=>e.stopPropagation());

        // Close on Escape
        document.addEventListener('keydown', (e)=>{
          if(e.key === 'Escape' && modal.classList.contains('open')) closeModal();
        });
      })();

      // Modal de autenticación (login / register)
      (function(){
        const accessBtn = document.getElementById('btn-access');
        const authModal = document.querySelector('.auth-modal');
        const authPanel = authModal?.querySelector('.auth-panel');
        const closeBtn = authModal?.querySelector('.auth-close');
        const tabs = authModal?.querySelectorAll('.auth-tab');
        const forms = authModal?.querySelectorAll('.auth-form');

        if(!accessBtn || !authModal) return;

        function openAuth(target){
          // show modal and select tab
          authModal.classList.add('open');
          authModal.setAttribute('aria-hidden','false');
          document.documentElement.classList.add('no-scroll');
          document.body.classList.add('no-scroll');
          // set tab
          selectTab(target || 'login');
          // focus first input
          setTimeout(()=>{
            const first = authModal.querySelector('.auth-form.active input');
            first?.focus();
          }, 50);
        }

        function closeAuth(){
          authModal.classList.remove('open');
          authModal.setAttribute('aria-hidden','true');
          document.documentElement.classList.remove('no-scroll');
          document.body.classList.remove('no-scroll');
        }

        function selectTab(name){
          tabs.forEach(t=>t.classList.toggle('active', t.dataset.target===name));
          forms.forEach(f=>f.classList.toggle('active', f.id === (name==='login' ? 'login-form' : 'register-form')));
        }

        accessBtn.addEventListener('click', ()=>openAuth('login'));

        // tab clicks
        tabs.forEach(t=>t.addEventListener('click', ()=>selectTab(t.dataset.target)));

        // close handlers
        closeBtn?.addEventListener('click', closeAuth);
        authModal.addEventListener('click', (e)=>{ if(e.target === authModal) closeAuth(); });
        document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && authModal.classList.contains('open')) closeAuth(); });

        // Real auth logic (client-side demo using localStorage)
        const USERS_KEY = 'campo_users_v1';
        const SESSION_KEY = 'campo_current_user_v1';

        function loadUsers(){
          try{ return JSON.parse(localStorage.getItem(USERS_KEY) || '{}'); }catch(e){ return {}; }
        }
        function saveUsers(obj){ localStorage.setItem(USERS_KEY, JSON.stringify(obj)); }

        async function hashPassword(password){
          const enc = new TextEncoder();
          const buf = await crypto.subtle.digest('SHA-256', enc.encode(password));
          return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,'0')).join('');
        }

        function setCurrentUser(key){
          localStorage.setItem(SESSION_KEY, key);
          renderUserState();
        }

        function clearCurrentUser(){
          localStorage.removeItem(SESSION_KEY);
          renderUserState();
        }

        function renderUserState(){
          const cur = localStorage.getItem(SESSION_KEY);
          const nav = document.querySelector('.nav-links');
          if(!nav) return;
          // remove existing user UI
          const existingLogout = document.getElementById('btn-logout');
          const existingUser = document.querySelector('.nav-user');
          if(existingLogout) existingLogout.remove();
          if(existingUser) existingUser.remove();
          // ensure access button exists
          let access = document.getElementById('btn-access');
          if(!access){
            access = document.createElement('button');
            access.className = 'btn btn-primary';
            access.id = 'btn-access';
            access.textContent = 'Acceder';
            nav.appendChild(access);
            access.addEventListener('click', ()=>openAuth('login'));
          }

          if(cur){
            const users = loadUsers();
            const user = users[cur];
            if(user){
              // replace access with greeting + logout
              access.remove();
              const span = document.createElement('span');
              span.className = 'nav-user';
              const display = (user.email || '').split('@')[0] || user.email;
              const direccionText = user.direccion ? ` - ${user.barrio || ''} - ${user.direccion}` : '';
              span.textContent = `Hola, ${display}${direccionText}`;
              nav.appendChild(span);
              const out = document.createElement('button');
              out.className = 'btn btn-outline';
              out.id = 'btn-logout';
              out.textContent = 'Cerrar sesión';
              nav.appendChild(out);
              out.addEventListener('click', ()=>{ clearCurrentUser(); });
            }
          }
        }

        // handle register (use email, password, role, barrio, direccion)
        const registerForm = document.getElementById('register-form');
        registerForm?.addEventListener('submit', async (e)=>{
          e.preventDefault();
          const email = (document.getElementById('reg-email')?.value || '').trim().toLowerCase();
          const password = document.getElementById('reg-pass')?.value || '';
          const role = document.getElementById('reg-role')?.value || '';
          const barrio = document.getElementById('reg-barrio')?.value || '';
          const direccion = (document.getElementById('reg-direccion')?.value || '').trim();
          if(!email || !password || !role || !barrio || !direccion){ alert('Completa todos los campos.'); return; }
          // simple email format check
          if(!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)){ alert('Introduce un correo válido.'); return; }
          const key = email;
          const users = loadUsers();
          if(users[key]){ alert('El correo ya está registrado. Usa otro.'); return; }
          if(password.length < 4){ if(!confirm('La contraseña es corta. ¿Continuar?')) return; }
          const hash = await hashPassword(password);
          users[key] = { email, passwordHash: hash, role, barrio, direccion, createdAt: new Date().toISOString() };
          saveUsers(users);
          setCurrentUser(key);
          alert('Cuenta creada.');
          closeAuth();
        });

        // handle login (email + password)
        const loginForm = document.getElementById('login-form');
        loginForm?.addEventListener('submit', async (e)=>{
          e.preventDefault();
          const email = (document.getElementById('login-email')?.value || '').trim().toLowerCase();
          const password = document.getElementById('login-pass')?.value || '';
          if(!email || !password){ alert('Completa todos los campos.'); return; }
          const key = email;
          const users = loadUsers();
          const user = users[key];
          if(!user){ alert('Usuario no encontrado.'); return; }
          const hash = await hashPassword(password);
          if(hash !== user.passwordHash){ alert('Contraseña incorrecta.'); return; }
          setCurrentUser(key);
          closeAuth();
        });

        // initialize UI state
        renderUserState();
      })();
    </script>
  </body>
</html>
